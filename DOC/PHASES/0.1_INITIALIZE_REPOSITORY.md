# Phase 0.1: Initialize Repository - Detailed Implementation Guide

## Overview

This phase establishes the foundational project structure and build system for the Veyrm roguelike. By the end of this phase, we'll have a working CMake configuration, proper directory structure, and a simple executable that validates our setup.

## Prerequisites

- CMake version 3.25 or higher installed
- C++ compiler supporting C++23 (GCC 12+, Clang 15+, or MSVC 2022+)
- Git installed and configured
- Terminal with UTF-8 support

## Directory Structure

```
verym/
├── CMakeLists.txt          # Root CMake configuration
├── src/                    # Source files
│   └── main.cpp           # Entry point
├── include/               # Header files
│   └── (empty initially)
├── data/                  # Game data files
│   ├── monsters.json      # Monster definitions
│   └── items.json        # Item definitions
├── tests/                 # Test files
│   └── CMakeLists.txt    # Test configuration
├── assets/               # Future: graphics/sounds
│   └── (empty initially)
└── docs/                 # Additional documentation
    └── (existing DOC files)
```

## Step-by-Step Implementation

### Step 1: Create Directory Structure

```bash
# From project root (/Users/nrf/repos/verym)
mkdir -p src include data tests assets
```

**Verification:**
```bash
ls -la
# Should show all directories created
```

### Step 2: Create Root CMakeLists.txt

Create `CMakeLists.txt` in project root:

```cmake
cmake_minimum_required(VERSION 3.25)

# Project definition
project(veyrm 
    VERSION 0.0.1
    DESCRIPTION "Modern C++ Roguelike inspired by Angband"
    LANGUAGES CXX
)

# C++ Standard
set(CMAKE_CXX_STANDARD 23)
set(CMAKE_CXX_STANDARD_REQUIRED ON)
set(CMAKE_CXX_EXTENSIONS OFF)

# Export compile commands for IDE integration
set(CMAKE_EXPORT_COMPILE_COMMANDS ON)

# Build type configuration
if(NOT CMAKE_BUILD_TYPE)
    set(CMAKE_BUILD_TYPE "Debug" CACHE STRING "Build type" FORCE)
endif()

message(STATUS "Build type: ${CMAKE_BUILD_TYPE}")
message(STATUS "C++ Standard: ${CMAKE_CXX_STANDARD}")
message(STATUS "Compiler: ${CMAKE_CXX_COMPILER_ID} ${CMAKE_CXX_COMPILER_VERSION}")

# Compiler-specific flags
if(CMAKE_CXX_COMPILER_ID MATCHES "GNU|Clang")
    add_compile_options(
        -Wall
        -Wextra
        -Wpedantic
        -Werror
        $<$<CONFIG:Debug>:-g>
        $<$<CONFIG:Debug>:-O0>
        $<$<CONFIG:Release>:-O3>
        $<$<CONFIG:Release>:-DNDEBUG>
    )
elseif(CMAKE_CXX_COMPILER_ID STREQUAL "MSVC")
    add_compile_options(
        /W4
        /WX
        $<$<CONFIG:Debug>:/Od>
        $<$<CONFIG:Release>:/O2>
    )
endif()

# Platform-specific definitions
if(WIN32)
    add_compile_definitions(PLATFORM_WINDOWS)
elseif(APPLE)
    add_compile_definitions(PLATFORM_MACOS)
elseif(UNIX)
    add_compile_definitions(PLATFORM_LINUX)
endif()

# Include directories
include_directories(${CMAKE_SOURCE_DIR}/include)

# Main executable
add_executable(veyrm src/main.cpp)

# Set executable output directory
set_target_properties(veyrm PROPERTIES
    RUNTIME_OUTPUT_DIRECTORY ${CMAKE_BINARY_DIR}/bin
)

# Platform-specific settings
if(WIN32)
    # Ensure UTF-8 on Windows
    target_compile_options(veyrm PRIVATE /utf-8)
endif()

# Installation rules
install(TARGETS veyrm DESTINATION bin)
install(DIRECTORY data/ DESTINATION share/veyrm/data)

# Testing (will be expanded in later phases)
enable_testing()
# add_subdirectory(tests) # Uncomment when tests are added

# Print configuration summary
message(STATUS "========================================")
message(STATUS "Veyrm Configuration Summary:")
message(STATUS "  Version: ${PROJECT_VERSION}")
message(STATUS "  Install prefix: ${CMAKE_INSTALL_PREFIX}")
message(STATUS "  Executable: ${CMAKE_BINARY_DIR}/bin/veyrm")
message(STATUS "========================================")
```

### Step 3: Create Initial main.cpp

Create `src/main.cpp`:

```cpp
#include <iostream>
#include <string>
#include <cstdlib>

// Platform-specific includes for UTF-8 support
#ifdef PLATFORM_WINDOWS
    #include <windows.h>
    #include <io.h>
    #include <fcntl.h>
#endif

// Version information
constexpr const char* VEYRM_VERSION = "0.0.1";
constexpr const char* VEYRM_BUILD_DATE = __DATE__;

/**
 * Initialize platform-specific settings
 */
void initializePlatform() {
#ifdef PLATFORM_WINDOWS
    // Enable UTF-8 support on Windows
    SetConsoleCP(CP_UTF8);
    SetConsoleOutputCP(CP_UTF8);
    _setmode(_fileno(stdout), _O_U8TEXT);
#endif
    
    // Set locale for proper Unicode handling
    std::locale::global(std::locale(""));
}

/**
 * Print welcome message with UTF-8 test
 */
void printWelcome() {
    std::cout << "╔══════════════════════════════════════╗\n";
    std::cout << "║         VEYRM ROGUELIKE              ║\n";
    std::cout << "║     The Shattered Crown Awaits       ║\n";
    std::cout << "╚══════════════════════════════════════╝\n";
    std::cout << "\n";
    std::cout << "Version: " << VEYRM_VERSION << "\n";
    std::cout << "Build Date: " << VEYRM_BUILD_DATE << "\n";
    std::cout << "Platform: ";
    
#ifdef PLATFORM_WINDOWS
    std::cout << "Windows";
#elif defined(PLATFORM_MACOS)
    std::cout << "macOS";
#elif defined(PLATFORM_LINUX)
    std::cout << "Linux";
#else
    std::cout << "Unknown";
#endif
    
    std::cout << "\n\n";
    
    // UTF-8 test with game-relevant characters
    std::cout << "UTF-8 Test:\n";
    std::cout << "  Walls: ═ ║ ╔ ╗ ╚ ╝ ╠ ╣ ╦ ╩ ╬\n";
    std::cout << "  Entities: @ r o ! ? † ☠\n";
    std::cout << "  Terrain: · # ≈ ∩ ▓ ░\n";
    std::cout << "\n";
}

/**
 * Run basic system checks
 */
bool runSystemChecks() {
    bool allPassed = true;
    
    std::cout << "Running system checks...\n";
    
    // Check C++ version
    std::cout << "  [";
    if (__cplusplus >= 202302L) {
        std::cout << "✓";
    } else {
        std::cout << "✗";
        allPassed = false;
    }
    std::cout << "] C++23 support\n";
    
    // Check terminal width (basic check)
    std::cout << "  [✓] Terminal output\n";
    
    // Check file system access
    std::cout << "  [";
    if (std::getenv("HOME") || std::getenv("USERPROFILE")) {
        std::cout << "✓";
    } else {
        std::cout << "⚠";
    }
    std::cout << "] Environment variables\n";
    
    std::cout << "\n";
    return allPassed;
}

/**
 * Main entry point
 */
int main(int argc, char* argv[]) {
    // Initialize platform-specific settings
    initializePlatform();
    
    // Print welcome message
    printWelcome();
    
    // Handle command-line arguments
    if (argc > 1) {
        std::string arg = argv[1];
        if (arg == "--version" || arg == "-v") {
            std::cout << "veyrm version " << VEYRM_VERSION << "\n";
            return 0;
        } else if (arg == "--help" || arg == "-h") {
            std::cout << "Usage: " << argv[0] << " [options]\n";
            std::cout << "Options:\n";
            std::cout << "  -h, --help     Show this help message\n";
            std::cout << "  -v, --version  Show version information\n";
            std::cout << "  --test         Run system checks\n";
            return 0;
        } else if (arg == "--test") {
            bool passed = runSystemChecks();
            if (passed) {
                std::cout << "All system checks passed! ✓\n";
                std::cout << "Ready to proceed with Phase 0.2\n";
                return 0;
            } else {
                std::cout << "Some checks failed. Please review the requirements.\n";
                return 1;
            }
        }
    }
    
    // Basic initialization message
    std::cout << "Initializing Veyrm...\n";
    std::cout << "CMake configuration successful!\n";
    std::cout << "Project structure created.\n";
    std::cout << "\n";
    std::cout << "Phase 0.1: Initialize Repository - COMPLETE ✓\n";
    std::cout << "\n";
    std::cout << "Next steps:\n";
    std::cout << "  1. Run with --test flag to verify system\n";
    std::cout << "  2. Proceed to Phase 0.2: Dependencies Setup\n";
    
    return 0;
}
```

### Step 4: Create Initial Data Files

Create `data/monsters.json`:

```json
{
  "version": "0.0.1",
  "monsters": []
}
```

Create `data/items.json`:

```json
{
  "version": "0.0.1",
  "items": []
}
```

### Step 5: Create Tests CMakeLists.txt

Create `tests/CMakeLists.txt`:

```cmake
# Tests configuration (placeholder for Phase 0.2)
# Will be populated when Catch2 is added

message(STATUS "Tests directory configured (awaiting Catch2 integration)")
```

## Build and Test Instructions

### First Build

```bash
# Create build directory
mkdir -p build
cd build

# Configure with CMake
cmake ..

# Build the project
cmake --build .

# Run the executable
./bin/veyrm
```

### Expected Output

```
╔══════════════════════════════════════╗
║         VEYRM ROGUELIKE              ║
║     The Shattered Crown Awaits       ║
╚══════════════════════════════════════╝

Version: 0.0.1
Build Date: [current date]
Platform: [your platform]

UTF-8 Test:
  Walls: ═ ║ ╔ ╗ ╚ ╝ ╠ ╣ ╦ ╩ ╬
  Entities: @ r o ! ? † ☠
  Terrain: · # ≈ ∩ ▓ ░

Initializing Veyrm...
CMake configuration successful!
Project structure created.

Phase 0.1: Initialize Repository - COMPLETE ✓

Next steps:
  1. Run with --test flag to verify system
  2. Proceed to Phase 0.2: Dependencies Setup
```

### System Test

```bash
./bin/veyrm --test
```

Expected output should show all checks passing.

## Validation Checklist

- [ ] CMake configures without errors
- [ ] Project builds without warnings
- [ ] Executable runs and displays welcome message
- [ ] UTF-8 characters display correctly
- [ ] --test flag shows all checks passing
- [ ] --version flag shows correct version
- [ ] --help flag shows usage information
- [ ] Directory structure matches specification

## Troubleshooting

### CMake Version Issues

If CMake 3.25 is not available:
```bash
# Check your CMake version
cmake --version

# If older, modify CMakeLists.txt line 1:
cmake_minimum_required(VERSION 3.20)  # Minimum fallback
```

### Compiler Issues

If C++23 is not supported:
```cmake
# In CMakeLists.txt, change:
set(CMAKE_CXX_STANDARD 20)  # Fall back to C++20
```

### UTF-8 Display Issues

**Windows:**
- Use Windows Terminal or PowerShell
- Ensure console font supports Unicode (Consolas, Cascadia Code)

**macOS/Linux:**
- Ensure LANG environment variable is set: `export LANG=en_US.UTF-8`

## Git Commands

After completing this phase:

```bash
# Create feature branch
git checkout -b feature/phase-0.1-init

# Add new files
git add .

# Commit
git commit -m "[Phase 0.1] Initialize repository structure

- Created CMake build system with C++23 support
- Set up directory structure (src, include, data, tests)
- Implemented basic main.cpp with UTF-8 support
- Added platform detection and system checks
- Tests: CMake builds successfully, executable runs
- Docs: Created detailed phase documentation"

# Tag the completion
git tag v0.0.1-project-init

# Merge to main
git checkout main
git merge feature/phase-0.1-init

# Push with tags
git push origin main --tags
```

## Success Criteria

✅ Phase 0.1 is complete when:

1. CMake configuration works on your platform
2. Project builds without errors or warnings
3. Executable runs and shows welcome message
4. UTF-8 characters display correctly
5. System test (--test flag) passes
6. Code is committed and tagged as v0.0.1-project-init

## Next Phase

Once this phase is complete and validated, proceed to:
**Phase 0.2: Dependencies Setup** - Configure FTXUI, nlohmann/json, and Catch2