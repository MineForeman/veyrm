# Phase 8.3: AI Design Notes

## Key Design Decisions

### Why 8-Way Movement?

- **Tactical Depth**: Allows for more sophisticated positioning in combat
- **Natural Movement**: Diagonal movement feels more fluid and realistic
- **Player Parity**: Player already has 8-way movement, monsters should too
- **Better Pathfinding**: More direct routes to targets, less "grid-like" movement
- **Classic Roguelike**: Most successful roguelikes (Angband, DCSS, etc.) use 8-way movement

### Why Room-Bound Behavior?

- **Tactical Gameplay**: Creates interesting decisions about luring monsters
- **Predictable Zones**: Players can learn which rooms are dangerous
- **Stealth Options**: Can sneak past rooms without alerting all monsters
- **Resource Management**: Players can clear rooms systematically
- **Immersion**: Monsters have "territory" they defend, feels more realistic

### Behavior Examples

#### Scenario 1: Kobold Guard

- Spawns in treasure room
- Wanders within room boundaries when idle
- Player enters room → Becomes hostile
- Chases player into corridor
- Player escapes around corner
- Kobold returns to treasure room

#### Scenario 2: Corridor Spider

- Spawns in corridor intersection
- No room restrictions
- Wanders freely through connected corridors
- Spots player → Pursues anywhere
- More dangerous as it can follow indefinitely

#### Scenario 3: Multiple Room Guards

- 3 Orcs in barracks room
- Player lures one out
- Other 2 stay in room (didn't see player)
- Lured orc chases, gets defeated in corridor
- Player can tackle remaining orcs separately

### Technical Benefits

#### Performance

- Room bounds limit pathfinding search space
- Idle monsters don't need complex decisions
- Can "sleep" monsters in distant rooms

#### Gameplay Balance

- Prevents entire level from swarming player
- Creates safe zones once rooms are cleared
- Allows strategic retreat and re-engagement

#### Implementation Simplicity

- Room assignment happens at spawn time
- Simple state machine for behavior
- Reuses existing room detection from map

### Monster Personality Through AI

Different monsters can have different behaviors:

#### Aggressive (Orc)

- Large aggression range
- Pursues relentlessly
- Slow to give up chase

#### Defensive (Kobold)

- Smaller aggression range
- Returns to room quickly
- Guards specific areas

#### Ambusher (Spider)

- Waits near doorways
- Fast movement speed
- No room loyalty

#### Wanderer (Rat)

- Low room loyalty
- May leave room even when not chasing
- Explores randomly

### Edge Case Handling

#### Monster in Doorway

- Assigned to room the doorway leads FROM
- Can block doorway tactically

#### Large Rooms

- Set maximum wander distance from spawn point
- Prevents monsters from covering too much area

#### Multiple Room Sections

- Monster assigned to specific section
- Uses spawn point as "home" location

#### Player Teleportation

- Clear "last seen position"
- Monster returns to idle state
- Returns to assigned room

### Future Expansion Possibilities

With this foundation, we can later add:

- **Pack Behavior**: Monsters alert nearby allies
- **Patrol Routes**: Predefined paths for guards
- **Fleeing**: Injured monsters retreat to rooms
- **Territorial Fights**: Different species compete
- **Day/Night Behavior**: Different patterns based on time
- **Learning AI**: Monsters adapt to player tactics

### Balance Considerations

- **Room Size**: Larger rooms = more dangerous (multiple monsters)
- **Corridor Width**: Narrow = easier to block, wide = harder to escape
- **Spawn Distribution**: 95% in rooms means corridors are usually safe
- **Vision Range**: Shorter = more stealth options
- **Chase Persistence**: How long before giving up

### Player Strategy Guide

This AI design enables various player strategies:

1. **Room Clearing**: Systematically clear each room
2. **Luring**: Draw out monsters one at a time
3. **Stealth**: Avoid rooms with many monsters
4. **Corridor Fighting**: Better 1v1 combat space
5. **Retreating**: Lead monsters away, then circle back
6. **Bottlenecking**: Use doorways to limit attackers

### Testing Priorities

1. **Room Boundaries**: Verify monsters respect boundaries
2. **State Transitions**: All states reachable and exit correctly
3. **Pathfinding**: Efficient paths, handles obstacles
4. **Multi-Monster**: No deadlocks or stuttering
5. **Performance**: 30+ active monsters without lag
