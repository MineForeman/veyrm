# Phase 7.3: Layout System

**Status:** ✅ Complete  
**Git Tag:** `v0.7.3-layout`

## Overview

Implemented a responsive, fullscreen layout system that dynamically adapts to terminal size while maintaining proper boundaries between UI panels.

## Implementation Details

### Key Components

1. **LayoutSystem Class** (`layout_system.h/cpp`)
   - Manages responsive layout calculations
   - Validates minimum terminal size (80x24)
   - Calculates panel dimensions based on terminal size
   - Provides layout decorators for FTXUI components

2. **Fullscreen Mode**
   - Changed from `ScreenInteractive::TerminalOutput()` to `ScreenInteractive::Fullscreen()`
   - Game now uses entire terminal window
   - Dynamic viewport sizing based on `Terminal::Size()`

3. **Three-Panel Layout**
   - **Map Panel** (left): Takes majority of screen space
   - **Status Panel** (right top): Player stats and game info
   - **Log Panel** (right bottom): Message history

### Layout Constraints

- **Minimum terminal size:** 80x24
- **Map viewport:** Dynamically sized (terminal_width - 50) to reserve right side
- **Right panels:** Fixed width of 42 characters
- **Borders and separators:** Properly accounted for in calculations

### Dynamic Sizing Algorithm

```cpp
// Get actual terminal dimensions
auto term_size = Terminal::Size();

// Calculate map viewport
int right_panel_width = 45;
int map_width = std::max(50, term_size.dimx - right_panel_width - 4);
int map_height = std::max(20, term_size.dimy - 2);

// Clamp to prevent overlap
map_width = std::min(map_width, term_size.dimx - 50);
```

## Features Implemented

### 1. Responsive Layout

- Adapts to any terminal size above 80x24
- Map panel expands to use available space
- Right panels maintain consistent width

### 2. Boundary Protection

- Player movement constrained to map viewport
- No overlap between map and status/log panels
- Proper clipping at panel boundaries

### 3. Terminal Size Validation

- Checks for minimum 80x24 size
- Shows error message if terminal too small
- Graceful degradation for edge cases

### 4. Unicode Tile Support

- Walls: `█` (solid blocks)
- Floors: `·` (middle dots)
- Stairs: `▼` (down), `▲` (up)
- Doors: `▦` (closed), `▢` (open)

## Testing

### Unit Tests

- `test_layout_system.cpp`: 6 test cases covering:
  - Default dimensions
  - Minimum size validation
  - Responsive calculations
  - Layout proportions
  - Edge cases
  - Error messages

### Manual Testing

- Verified fullscreen mode works on various terminal sizes
- Confirmed player cannot move under status/log panels
- Tested terminal resizing (though live resize not yet supported)

## Known Limitations

1. **Live Resize:** Terminal resizing requires game restart to take effect
2. **Fixed Right Panel Width:** Right panels don't scale with very large terminals
3. **No Horizontal Scrolling:** Very wide maps may be clipped

## Future Enhancements

1. **Live Terminal Resize Detection**
   - Hook into terminal resize events
   - Dynamically adjust layout without restart

2. **Scalable Right Panels**
   - Calculate right panel width as percentage of terminal width
   - Maintain minimum widths for readability

3. **Multi-Column Message Log**
   - Use extra width in very wide terminals
   - Show more message history

## Files Modified

- `include/layout_system.h`: New layout system class
- `src/layout_system.cpp`: Layout calculations and validation
- `include/game_screen.h`: Added layout system integration
- `src/game_screen.cpp`: Fullscreen mode and dynamic sizing
- `src/main.cpp`: Changed to `Fullscreen()` mode
- `tests/test_layout_system.cpp`: Comprehensive unit tests
- `tests/CMakeLists.txt`: Added layout tests
- `CMakeLists.txt`: Added layout_system source files

## Dependencies

- **FTXUI**: Terminal UI framework
  - `Terminal::Size()` for dimension detection
  - `ScreenInteractive::Fullscreen()` for fullscreen mode
  - Flex decorators for responsive sizing

## Notes

The layout system successfully provides a fullscreen roguelike experience while maintaining clear boundaries between game areas. The dynamic sizing ensures the game looks good on various terminal sizes while preventing UI overlap issues.
