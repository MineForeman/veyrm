# Phase 11.1: Inventory Storage - Implementation Checklist

## Pre-Implementation Setup
- [x] Create feature branch: `git checkout -b feature/phase-11.1-inventory-storage`
- [x] Review Phase 10.1 Item system code
- [x] Review current Player implementation
- [x] Plan test cases

## Core Implementation

### Step 1: Create Inventory Class
- [x] Create `include/inventory.h` with class definition
- [x] Define capacity constants (26 slots for a-z)
- [x] Add member variables (capacity, items vector)
- [x] Declare public interface methods
- [x] Declare private helper methods

### Step 2: Implement Basic Operations
- [x] Create `src/inventory.cpp`
- [x] Implement constructor and destructor
- [x] Implement `addItem()`
  - [x] Check capacity
  - [x] Add to items vector
  - [x] Return success/failure
- [x] Implement `removeItem(slot)`
  - [x] Validate slot
  - [x] Remove and return item
- [x] Implement `getItem(slot)`
  - [x] Validate slot
  - [x] Return item pointer or nullptr
- [x] Implement `isFull()` and `hasSpace()`
- [x] Implement `clear()` method

### Step 3: Add Stacking Support
- [x] Implement `canStackWith()` method
- [x] Implement `tryStack()` helper
  - [x] Find matching stackable item
  - [x] Calculate space available
  - [x] Update stack sizes
- [x] Update `addItem()` to try stacking first
- [x] Test partial stack handling

### Step 4: Implement Query Methods
- [x] Implement `findItem(item_id)`
- [x] Implement `findItems(type)`
- [x] Implement `findSlot(item)`
- [x] Implement `getAllItems()`
- [x] Implement `getUsedSlots()`

### Step 5: Player Integration
- [x] Update `include/player.h`
  - [x] Add `inventory` member
  - [x] Add `pickupItem()` method
  - [x] Add `dropItem()` method
  - [x] Add inventory query helpers
- [x] Update `src/player.cpp`
  - [x] Initialize inventory in constructor
  - [x] Implement `pickupItem()`
    - [x] Special case for gold
    - [x] Delegate to inventory
  - [x] Implement `dropItem()`
  - [x] Implement query helpers

### Step 6: Game Integration
- [x] Update `src/game_screen.cpp`
  - [x] Modify GET_ITEM handler
  - [x] Check inventory space before pickup
  - [x] Show "inventory full" message
  - [x] Handle stacking automatically
- [x] Update item pickup flow
  - [x] Create item copy for inventory
  - [x] Remove from world on successful pickup
  - [x] Leave in world if inventory full

### Step 7: Add CMake Configuration
- [x] Update `CMakeLists.txt`
  - [x] Add `src/inventory.cpp` to sources
- [x] Update `tests/CMakeLists.txt`
  - [x] Add `test_inventory.cpp` to test sources

## Testing

### Step 8: Write Unit Tests
- [x] Create `tests/test_inventory.cpp`
- [x] Test basic operations
  - [x] Add/remove items
  - [x] Capacity limits
  - [x] Empty inventory
- [x] Test stacking
  - [x] Same items stack
  - [x] Respect max_stack
  - [x] Non-stackable don't stack
  - [x] Partial stacks
- [x] Test queries
  - [x] Find by ID
  - [x] Find by type
  - [x] Get by slot
- [x] Test edge cases
  - [x] Null items
  - [x] Invalid slots
  - [x] Full inventory

### Step 9: Integration Testing
- [x] Test player inventory initialization
- [x] Test pickup with space available
- [x] Test pickup when full
- [x] Test gold special handling
- [x] Test message log updates
- [x] Test turn consumption

### Step 10: Manual Testing
- [x] Build and run game
- [x] Pick up various items
- [x] Fill inventory to capacity
- [x] Test stackable items (gold, arrows)
- [x] Verify messages are correct
- [x] Check for memory leaks

## Documentation

### Step 11: Update Documentation
- [ ] Update `DOC/IMPLEMENTATION_PLAN.md`
  - [ ] Mark 11.1 as complete
- [ ] Create implementation notes
- [ ] Document any design decisions
- [ ] Note any deviations from plan

### Step 12: Code Documentation
- [ ] Add class documentation comments
- [ ] Document public methods
- [ ] Document complex algorithms
- [ ] Add usage examples

## Code Review Checklist

### Before Committing
- [x] All tests pass (135 test cases, 1775 assertions)
- [x] No compiler warnings
- [x] No memory leaks (valgrind/sanitizers)
- [x] Code follows project style
- [x] Documentation updated

### Git Operations
- [ ] Stage all changes: `git add -A`
- [ ] Commit with message: `[Phase 11.1] Implement inventory storage`
- [ ] Run tests again
- [ ] Push to feature branch
- [ ] Create PR if using GitHub
- [ ] Merge to main
- [ ] Tag release: `git tag v0.11.1-inventory-storage`

## Validation Criteria
- [x] Can pick up items into inventory
- [x] Inventory enforces capacity limit
- [x] Stackable items stack correctly
- [x] Gold bypasses inventory system
- [x] Messages display appropriately
- [x] No crashes or memory issues
- [x] All unit tests pass

## Time Estimate
- Core implementation: 2-3 hours
- Testing: 1-2 hours
- Documentation: 30 minutes
- Total: ~4-5 hours

## Potential Issues to Watch
1. **Memory management** - Ensure proper use of unique_ptr
2. **Stacking edge cases** - Test thoroughly
3. **Gold handling** - Must bypass inventory
4. **Message clarity** - "Inventory full" vs other errors
5. **Performance** - Inventory operations should be O(1) or O(n)

## Dependencies to Verify
- [x] Item system working correctly
- [x] ItemFactory can create items
- [x] Player class is stable
- [x] Game screen pickup handler exists

## Post-Implementation
- [ ] Update CHANGELOG.md
- [ ] Update README if needed
- [ ] Plan Phase 11.2 (Inventory UI)
- [ ] Consider save/load implications

## Notes Space
_Use this space for notes during implementation:_

### Implementation Notes (Completed)
- Fixed incomplete type error by including full item.h instead of forward declaration
- All tests passing successfully
- Inventory system fully integrated with game
- Stacking system working as designed
- Gold correctly bypasses inventory and adds to player gold counter

---

## Quick Command Reference
```bash
# Create branch
git checkout -b feature/phase-11.1-inventory-storage

# Build and test
./build.sh clean
./build.sh build
./build.sh test

# Run specific tests
./build/bin/veyrm_tests "[inventory]"

# Check for memory leaks
valgrind --leak-check=full ./build/bin/veyrm

# Commit when done
git add -A
git commit -m "[Phase 11.1] Implement inventory storage system"
git tag v0.11.1-inventory-storage
```